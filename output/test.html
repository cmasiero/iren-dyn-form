<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/example/example.css">
    <title>Scheda Raccolta dati U4</title>
  </head>

  <body>


  </body>
  <form onsubmit="postScheda()"><input type="button" value="Invia" onclick="postScheda()">
    <div class="table-title" id="id_title_00">
      Dati Generali
    </div>
    <div class="div-table" id="00">
      <div class="div-table-row" id="id_row_0">
        <div class="div-table-col" id="id_col_0_0"><strong>Dati Generali</strong></div>
        <div class="div-table-col" id="id_col_0_1">
          <label for="id_codice_cabina">CODICE CABINA</label>
          <input type="text" id="id_codice_cabina" value="">
        </div>
        <div class="div-table-col" id="id_col_0_2">
          <label for="id_data">DATA</label>
          <input type="text" id="id_data" value="">
        </div>
        <div class="div-table-col" id="id_col_0_3">
          <label for="id_nome_cognome">NOME COGNOME</label>
          <input type="text" id="id_nome_cognome" value="">
        </div>
        <div class="div-table-col" id="id_col_0_4">
          <label for="id_codice_attivita_ofsc">CODICE ATTIVITA' OFSC</label>
          <input type="text" id="id_codice_attivita_ofsc" value="">
        </div>
        <div class="div-table-col" id="id_col_0_5">
          <label for="id_ordine_di_manutenzione_sap_pm">ORDINE DI MANUTENZIONE SAP PM</label>
          <input type="text" id="id_ordine_di_manutenzione_sap_pm" value="">
        </div>
      </div>
    </div>
    <div class="table-title" id="id_title_01">
      Cabine Secondarie
    </div>
    <div class="div-table" id="01">
      <div class="div-table-row" id="id_row_1">
        <div class="div-table-col" id="id_col_1_0"><strong>area 1</strong></div>
        <div class="div-table-col" id="id_col_1_1">
          <label for="id_tipologia_di_attivita">TIPOLOGIA DI ATTIVITA'</label>
          <select name="id_tipologia_di_attivita" id="id_tipologia_di_attivita">
            <option value=""></option>
            <option value="MESSA IN SERVIZIO">messa in servizio</option>
            <option value="CENSIMENTO">censimento</option>
            <option value="OPERE EDILI">opere edili</option>
            <option value="DISMISSIONE">dismissione</option>
          </select>
        </div>
      </div>
      <div class="div-table-row" id="id_row_2">
        <div class="div-table-col" id="id_col_2_0"><strong>area 2</strong></div>
        <div class="div-table-col" id="id_col_2_1">
          <label for="id_codice_identificativo_cabina">CODICE IDENTIFICATIVO DELLA CABINA</label>
          <input type="text" id="id_codice_identificativo_cabina" value="">
        </div>
        <div class="div-table-col" id="id_col_2_2">
          <label for="id_dimensione_locale_cabina">DIMENSIONE LOCALE CABINA</label>
          <input type="text" id="id_dimensione_locale_cabina" value="">
        </div>
        <div class="div-table-col" id="id_col_2_3">
          <label for="id_livello_tensione">LIVELLO TENSIONE (kV)</label>
          <select name="id_livello_tensione" id="id_livello_tensione">
            <option value=""></option>
            <option value="5.4">5,4</option>
            <option value="6.3">6,3</option>
            <option value="15">15</option>
            <option value="22">22</option>
            <option value="27">27</option>
          </select>
        </div>
      </div>
    </div>
  </form>
  <script type="text/javascript">
    (function() {
      console.log("doc ready");
      visibility();
      let form = document.querySelector('form');
      form.addEventListener('change', function() {
        visibility();
      });
    })();

    function visibilityParent(element) {
      let col = element.parentNode;
      let children = col.childNodes;

      let displayCol = false;
      for (let i = 0; i < children.length; i++) {
        if (children[i].style !== undefined && children[i].style.display !== 'none') {
          displayCol = true;
          break;
        }
      }
      col.style.display = displayCol ? "inline" : "none";
    }

    function visibility() {
      console.log("[visibility]");
      if (document.getElementById('id_tipologia_di_attivita').value == 'MESSA IN SERVIZIO' || document.getElementById('id_tipologia_di_attivita').value == 'CENSIMENTO' || document.getElementById('id_tipologia_di_attivita').value == 'OPERE EDILI') {
        let node = document.getElementById('id_dimensione_locale_cabina');
        node.style.display = "inline";
        if (node.previousElementSibling !== null) {
          node.previousElementSibling.style.display = "inline";
        } else {
          node.nextElementSibling.style.display = "inline";
        }
        visibilityParent(node);
      } else {
        let node = document.getElementById('id_dimensione_locale_cabina');
        node.style.display = "none";
        if (node.previousElementSibling !== null) {
          node.previousElementSibling.style.display = "none";
        } else {
          node.nextElementSibling.style.display = "none";
        }
        visibilityParent(node);
      }
      if (document.getElementById('id_tipologia_di_attivita').value == 'MESSA IN SERVIZIO' || document.getElementById('id_tipologia_di_attivita').value == 'CENSIMENTO') {
        let node = document.getElementById('id_livello_tensione');
        node.style.display = "inline";
        if (node.previousElementSibling !== null) {
          node.previousElementSibling.style.display = "inline";
        } else {
          node.nextElementSibling.style.display = "inline";
        }
        visibilityParent(node);
      } else {
        let node = document.getElementById('id_livello_tensione');
        node.style.display = "none";
        if (node.previousElementSibling !== null) {
          node.previousElementSibling.style.display = "none";
        } else {
          node.nextElementSibling.style.display = "none";
        }
        visibilityParent(node);
      }
    }

    function validation() {
      let result = [];
      let v_id_codice_cabina = document.getElementById('id_codice_cabina').value;
      if (v_id_codice_cabina === '') {
        result.push("Il campo CODICE CABINA è obbligatorio!");
      }
      let v_id_data = document.getElementById('id_data').value;
      if (v_id_data === '') {
        result.push("Il campo DATA è obbligatorio!");
      }
      let v_id_nome_cognome = document.getElementById('id_nome_cognome').value;
      if (v_id_nome_cognome === '') {
        result.push("Il campo NOME COGNOME è obbligatorio!");
      }
      let v_id_tipologia_di_attivita = document.getElementById('id_tipologia_di_attivita').value;
      if (v_id_tipologia_di_attivita === '') {
        result.push("Il campo TIPOLOGIA DI ATTIVITA' è obbligatorio!");
      }
      let v_id_codice_identificativo_cabina = document.getElementById('id_codice_identificativo_cabina').value;
      if (v_id_codice_identificativo_cabina === '') {
        result.push("Il campo CODICE IDENTIFICATIVO DELLA CABINA è obbligatorio!");
      }
      if (document.getElementById('id_tipologia_di_attivita').value == 'MESSA IN SERVIZIO' || document.getElementById('id_tipologia_di_attivita').value == 'CENSIMENTO') {
        let v_id_dimensione_locale_cabina = document.getElementById('id_dimensione_locale_cabina').value;
        if (v_id_dimensione_locale_cabina === '') {
          result.push("Il campo DIMENSIONE LOCALE CABINA è obbligatorio!");
        }
      }
      if (document.getElementById('id_tipologia_di_attivita').value == 'MESSA IN SERVIZIO' || document.getElementById('id_tipologia_di_attivita').value == 'CENSIMENTO') {
        let v_id_livello_tensione = document.getElementById('id_livello_tensione').value;
        if (v_id_livello_tensione === '') {
          result.push("Il campo LIVELLO TENSIONE (kV) è obbligatorio!");
        }
      }
      return result;
    }

    function postScheda() {
      let arrayMessage = validation();
      let message = ""
      arrayMessage.forEach(msg => {
        message = message.concat(msg).concat("\n");
      });
      if (message !== "") {
        alert(message);
      } else {
        alert("DEBUG: FORM VALIDO, VERRA INVIATO AL SERVER!");
      }
    }
  </script>

</html>